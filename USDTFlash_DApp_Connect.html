
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>USDTFlash DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-image: url('https://i.ibb.co/tPVdT1d/usdt-binance-bg.jpg');
      background-size: cover;
      background-position: center;
      color: white;
      padding: 20px;
      backdrop-filter: blur(4px);
    }

    h2, h3 {
      color: #00ffcc;
    }

    input, button {
      padding: 10px;
      margin: 5px;
      border-radius: 8px;
      border: none;
      font-size: 1em;
    }

    button {
      background-color: #00cc99;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #009977;
    }

    #eventLog {
      list-style-type: none;
      padding: 0;
    }

    #eventLog li {
      background: rgba(255, 255, 255, 0.1);
      margin: 5px 0;
      padding: 10px;
      border-radius: 5px;
    }

    .section {
      background-color: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <div style="text-align:center;">
    <button id="connectButton" style="
      padding: 15px 30px;
      font-size: 18px;
      background-color: #f6851b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 20px;
    ">
      <img src="https://raw.githubusercontent.com/MetaMask/brand-resources/master/SVG/metamask-fox.svg" alt="MetaMask" style="height: 24px; vertical-align: middle; margin-right: 10px;">
      Conectar con MetaMask
    </button>
  </div>

  <div class="section">
    <h2>Interactuar con USDTFlash</h2>
    <p><strong>Dirección del contrato:</strong> <span id="contractAddress"></span></p>
    <p><strong>Nombre del token:</strong> <span id="tokenName"></span></p>
    <p><strong>Símbolo:</strong> <span id="tokenSymbol"></span></p>
    <p><strong>Mi balance:</strong> <span id="userBalance"></span></p>
    <p><strong>Total Supply:</strong> <span id="supply"></span></p>
  </div>

  <div class="section">
    <h3>Enviar tokens</h3>
    <input type="text" id="toAddress" placeholder="Dirección del destinatario">
    <input type="number" id="amount" placeholder="Cantidad">
    <button onclick="transfer()">Transferir</button>
    <p id="txStatus"></p>
  </div>

  <div class="section">
    <h3>Eventos recientes</h3>
    <button onclick="loadEvents()">Cargar eventos</button>
    <ul id="eventLog"></ul>
  </div>

  <script>
    const contractAddress = "0xa85c7b43813a39966c28cf205147156a80cb86aa";
    const contractABI = [{"inputs": [{"internalType": "uint256", "name": "initialSupply", "type": "uint256"}, {"internalType": "uint256", "name": "durationInMinutes", "type": "uint256"}], "stateMutability": "nonpayable", "type": "constructor"}, {"inputs": [], "name": "decimals", "outputs": [{"internalType": "uint8", "name": "", "type": "uint8"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "expirationTime", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "hasExpired", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "name", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "owner", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "symbol", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "totalSupply", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "", "type": "address"}], "name": "balanceOf", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "recipient", "type": "address"}, {"internalType": "uint256", "name": "amount", "type": "uint256"}], "name": "transfer", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "spender", "type": "address"}, {"internalType": "uint256", "name": "amount", "type": "uint256"}], "name": "approve", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "sender", "type": "address"}, {"internalType": "address", "name": "recipient", "type": "address"}, {"internalType": "uint256", "name": "amount", "type": "uint256"}], "name": "transferFrom", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "nonpayable", "type": "function"}];

    let web3;
    let contract;
    let userAccount;

    async function init() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await ethereum.enable();
        const accounts = await web3.eth.getAccounts();
        userAccount = accounts[0];

        contract = new web3.eth.Contract(contractABI, contractAddress);
        document.getElementById("contractAddress").textContent = contractAddress;

        const name = await contract.methods.name().call();
        const symbol = await contract.methods.symbol().call();
        const balance = await contract.methods.balanceOf(userAccount).call();
        const supply = await contract.methods.totalSupply().call();

        document.getElementById("tokenName").textContent = name;
        document.getElementById("tokenSymbol").textContent = symbol;
        document.getElementById("userBalance").textContent = web3.utils.fromWei(balance, 'ether') + " " + symbol;
        document.getElementById("supply").textContent = web3.utils.fromWei(supply, 'ether') + " " + symbol;
      } else {
        alert("Por favor, instala Metamask");
      }
    }

    async function transfer() {
      const to = document.getElementById("toAddress").value;
      const amount = document.getElementById("amount").value;
      const value = web3.utils.toWei(amount, 'ether');
      try {
        const receipt = await contract.methods.transfer(to, value).send({ from: userAccount });
        document.getElementById("txStatus").textContent = "Transferencia confirmada en tx: " + receipt.transactionHash;
      } catch (err) {
        document.getElementById("txStatus").textContent = "Error: " + err.message;
      }
    }

    async function loadEvents() {
      const events = await contract.getPastEvents('Transfer', {
        fromBlock: 0,
        toBlock: 'latest'
      });
      const log = document.getElementById("eventLog");
      log.innerHTML = "";
      events.forEach(e => {
        const li = document.createElement("li");
        li.textContent = `De: ${e.returnValues.from} → Para: ${e.returnValues.to} | Cantidad: ${web3.utils.fromWei(e.returnValues.value, 'ether')}`;
        log.appendChild(li);
      });
    }

    
    document.getElementById("connectButton").onclick = async () => {
      await init();
    };

  </script>
</body>
</html>
